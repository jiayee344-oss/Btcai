<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BTC/USDT è‡ªåŠ¨äº¤æ˜“ä¿¡å·ç³»ç»Ÿ</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* è‡ªå®šä¹‰æ ·å¼ */
        .signal-buy {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(6, 78, 59, 0.1));
            border-left: 4px solid #10b981;
            border: 2px solid #10b981;
        }
        .signal-sell {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(127, 29, 29, 0.1));
            border-left: 4px solid #ef4444;
            border: 2px solid #ef4444;
        }
        .signal-hold {
            background: linear-gradient(135deg, rgba(156, 163, 175, 0.15), rgba(55, 65, 81, 0.1));
            border-left: 4px solid #9ca3af;
            border: 2px solid #9ca3af;
        }
        .price-hit {
            animation: pulse 1.5s infinite;
        }
        .blink {
            animation: blink 1s infinite;
        }
        .progress-bar {
            transition: width 0.5s ease;
        }
        .ai-thinking {
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #10b981);
            background-size: 200% 200%;
            animation: gradient 2s ease infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100">
    <div class="container mx-auto p-4 max-w-6xl">
        <!-- å¤´éƒ¨ -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-yellow-500 mb-2">
                <i class="fas fa-robot mr-2"></i>BTC/USDT è‡ªåŠ¨äº¤æ˜“ä¿¡å·ç³»ç»Ÿ
            </h1>
            <p class="text-gray-400">å…¨è‡ªåŠ¨è¿è¡Œ | åŸºäºOKXäº¤æ˜“æ‰€å®æ—¶æ•°æ® | æ‰€æœ‰è®¿é—®è€…ä¿¡å·ä¸€è‡´</p>
        </div>

        <!-- ç³»ç»ŸçŠ¶æ€æ  -->
        <div class="mb-6 p-4 bg-gray-800 rounded-lg border border-gray-700">
            <div class="grid grid-cols-2 md:grid-cols-5 gap-4">
                <div>
                    <div class="text-gray-400 text-sm">ç³»ç»ŸçŠ¶æ€</div>
                    <div id="systemStatus" class="text-green-400">
                        <i class="fas fa-circle mr-1"></i>åˆå§‹åŒ–ä¸­...
                    </div>
                </div>
                <div>
                    <div class="text-gray-400 text-sm">æ•°æ®æº</div>
                    <div class="text-yellow-400 text-sm">OKXäº¤æ˜“æ‰€</div>
                </div>
                <div>
                    <div class="text-gray-400 text-sm">äº¤æ˜“æ¨¡å¼</div>
                    <div class="text-blue-400 text-sm">å…¨è‡ªåŠ¨</div>
                </div>
                <div>
                    <div class="text-gray-400 text-sm">ä¿¡å·åŒæ­¥</div>
                    <div class="text-green-400 text-sm">å·²å¯ç”¨</div>
                </div>
                <div>
                    <div class="text-gray-400 text-sm">ç‰ˆæœ¬</div>
                    <div class="text-purple-400 text-sm">v2.1</div>
                </div>
            </div>
        </div>

        <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- å·¦ä¾§ï¼šå®æ—¶ä»·æ ¼ -->
            <div class="bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-700">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-semibold">
                        <i class="fas fa-chart-line text-blue-400 mr-2"></i>å®æ—¶å¸‚åœºæ•°æ®
                    </h2>
                    <span id="marketStatus" class="px-3 py-1 text-xs rounded-full bg-green-900 text-green-300">
                        <i class="fas fa-circle animate-pulse mr-1"></i>å®æ—¶æ›´æ–°
                    </span>
                </div>
                <div class="text-center py-4">
                    <div id="priceDisplay" class="text-5xl font-bold text-green-400 mb-2">$--</div>
                    <div class="text-gray-400 mb-1">BTC/USDT</div>
                    <div id="updateTime" class="text-sm text-gray-500">--:--:--</div>
                    <div class="mt-4 grid grid-cols-2 gap-3">
                        <div class="text-center p-3 bg-gray-900 rounded">
                            <div class="text-gray-400 text-sm">24Hé«˜</div>
                            <div id="high24h" class="text-green-400 font-bold text-lg">$--</div>
                        </div>
                        <div class="text-center p-3 bg-gray-900 rounded">
                            <div class="text-gray-400 text-sm">24Hä½</div>
                            <div id="low24h" class="text-red-400 font-bold text-lg">$--</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä¸­é—´ï¼šAIä¿¡å· -->
            <div id="signalCard" class="signal-hold rounded-xl p-6 shadow-lg">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-semibold">
                        <i class="fas fa-robot text-purple-400 mr-2"></i>AIäº¤æ˜“ä¿¡å·
                    </h2>
                    <div id="signalStatus" class="px-3 py-1 text-xs rounded-full bg-purple-900 text-purple-300">
                        <i class="fas fa-cog fa-spin mr-1"></i>åˆ†æä¸­...
                    </div>
                </div>
                
                <div id="aiAnalysis" class="mb-4 p-3 bg-gray-900/50 rounded-lg border border-gray-700">
                    <div class="flex items-center text-gray-400 text-sm mb-2">
                        <i class="fas fa-brain mr-2"></i>
                        <span>AIåˆ†æè¿‡ç¨‹:</span>
                    </div>
                    <div id="analysisText" class="text-sm text-gray-300">
                        æ­£åœ¨åˆ†æå¸‚åœºæ•°æ®ï¼Œè®¡ç®—æŠ€æœ¯æŒ‡æ ‡...
                    </div>
                </div>
                
                <div class="text-center py-2">
                    <div id="signalAction" class="text-5xl font-bold mb-4">--</div>
                    <div class="text-2xl text-gray-300 mb-1">
                        ç½®ä¿¡åº¦: <span id="signalConfidence" class="text-yellow-400">--%</span>
                    </div>
                    <div id="signalTime" class="text-sm text-gray-500">--:--:--</div>
                </div>
            </div>

            <!-- å³ä¾§ï¼šäº¤æ˜“å‚æ•° -->
            <div class="bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-700">
                <h2 class="text-xl font-semibold mb-6">
                    <i class="fas fa-calculator text-red-400 mr-2"></i>äº¤æ˜“å‚æ•°è®¡ç®—
                </h2>
                
                <div class="space-y-5">
                    <div class="p-3 bg-gray-900 rounded-lg">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-gray-400">å…¥åœºä»·æ ¼ (Entry)</span>
                            <span id="entryPrice" class="text-2xl font-bold text-white">$--</span>
                        </div>
                        <div class="text-xs text-gray-500">å½“å‰å¸‚åœºä»·æ ¼</div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="p-3 bg-green-900/30 rounded-lg border border-green-800">
                            <div class="text-green-400 font-semibold mb-1">æ­¢ç›ˆç›®æ ‡ (TP)</div>
                            <div id="takeProfit1" class="text-xl font-bold price-tp1">$--</div>
                            <div id="takeProfit2" class="text-lg text-green-300 price-tp2">$--</div>
                            <div class="text-xs text-gray-400 mt-1">é£é™©å›æŠ¥æ¯”: <span id="riskReward">--</span></div>
                        </div>
                        
                        <div class="p-3 bg-red-900/30 rounded-lg border border-red-800">
                            <div class="text-red-400 font-semibold mb-1">æ­¢æŸä»·æ ¼ (SL)</div>
                            <div id="stopLoss" class="text-xl font-bold price-sl">$--</div>
                            <div class="text-xs text-red-300 mt-1">ä¿æŠ¤æœ¬é‡‘</div>
                        </div>
                    </div>
                    
                    <div class="p-3 bg-blue-900/20 rounded-lg border border-blue-800">
                        <div class="text-blue-400 font-semibold mb-1">å»ºè®®ä»“ä½ (100USDTæœ¬é‡‘)</div>
                        <div class="flex items-end justify-between">
                            <div>
                                <div id="positionSize" class="text-2xl font-bold">-- USDT</div>
                                <div class="text-xs text-gray-400 mt-1">æ¯æ¬¡äº¤æ˜“é‡‘é¢</div>
                            </div>
                            <div class="text-right">
                                <div id="positionPercent" class="text-lg">--%</div>
                                <div class="text-xs text-gray-400">è´¦æˆ·å æ¯”</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-3 bg-yellow-900/20 rounded-lg border border-yellow-800">
                        <div class="text-yellow-400 text-sm">
                            <i class="fas fa-info-circle mr-2"></i>
                            ç­–ç•¥å‚æ•°: TP1:+1.5% | TP2:+3% | SL:-1.2% | é£é™©:2%
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç¬¬äºŒè¡Œï¼šç›‘æ§å’Œå›¾è¡¨ -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- ä»·æ ¼ç›‘æ§ -->
            <div class="bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-700">
                <h2 class="text-xl font-semibold mb-4">
                    <i class="fas fa-bullseye text-yellow-400 mr-2"></i>ä»·æ ¼ç›®æ ‡ç›‘æ§
                </h2>
                <div class="space-y-4">
                    <div class="grid grid-cols-3 gap-2 mb-6">
                        <div class="text-center p-3 bg-gray-900 rounded">
                            <div class="text-gray-400 text-sm">å½“å‰ä»·æ ¼</div>
                            <div id="monitorCurrent" class="text-xl font-bold text-white">$--</div>
                        </div>
                        <div class="text-center p-3 bg-green-900/30 rounded">
                            <div class="text-green-400 text-sm">TP1è·ç¦»</div>
                            <div id="distanceTP1" class="text-xl font-bold">--%</div>
                        </div>
                        <div class="text-center p-3 bg-red-900/30 rounded">
                            <div class="text-red-400 text-sm">SLè·ç¦»</div>
                            <div id="distanceSL" class="text-xl font-bold">--%</div>
                        </div>
                    </div>
                    
                    <div class="relative h-6 bg-gray-700 rounded-full overflow-hidden mb-2">
                        <div id="priceProgress" class="absolute h-full bg-gradient-to-r from-red-500 via-yellow-500 to-green-500 progress-bar"></div>
                        <div class="absolute top-0 left-0 right-0 h-full flex justify-between px-2">
                            <div class="h-full w-px bg-red-800"></div>
                            <div class="h-full w-px bg-yellow-800"></div>
                            <div class="h-full w-px bg-green-800"></div>
                        </div>
                    </div>
                    
                    <div class="flex justify-between text-xs text-gray-400 px-1">
                        <div>SL</div>
                        <div>å…¥åœºä»·</div>
                        <div>TP1</div>
                        <div>TP2</div>
                    </div>
                    
                    <div class="mt-6">
                        <div class="flex justify-between items-center mb-2">
                            <div class="text-gray-400">äº¤æ˜“çŠ¶æ€:</div>
                            <div id="tradeStatus" class="px-3 py-1 rounded-full bg-gray-700 text-gray-300">
                                <i class="fas fa-clock mr-1"></i>ç­‰å¾…ä¿¡å·
                            </div>
                        </div>
                        <div id="statusMessage" class="text-sm text-gray-400">
                            ç³»ç»Ÿåˆå§‹åŒ–ä¸­ï¼Œè¯·ç¨å€™...
                        </div>
                    </div>
                </div>
            </div>

            <!-- å›¾è¡¨ -->
            <div class="bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-700">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold">
                        <i class="fas fa-chart-bar text-blue-400 mr-2"></i>BTC/USDT 5åˆ†é’Ÿå›¾è¡¨
                    </h2>
                    <div class="flex items-center space-x-2">
                        <select id="timeframeSelect" class="bg-gray-700 border border-gray-600 rounded px-3 py-1 text-sm">
                            <option value="5m">5åˆ†é’Ÿ</option>
                            <option value="15m" selected>15åˆ†é’Ÿ</option>
                            <option value="1H">1å°æ—¶</option>
                        </select>
                        <button onclick="loadChartData()" class="px-3 py-1 bg-gray-700 rounded text-sm hover:bg-gray-600">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                </div>
                <div class="h-72">
                    <canvas id="priceChart"></canvas>
                </div>
                <div class="mt-4 text-center text-gray-500 text-sm">
                    å®æ—¶ä»·æ ¼èµ°åŠ¿ | AIåˆ†ææ ‡è®°ç‚¹
                </div>
            </div>
        </div>

        <!-- ç¬¬ä¸‰è¡Œï¼šAIåˆ†æå’Œæ§åˆ¶ -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- AIåˆ†æè¯¦æƒ… -->
            <div class="lg:col-span-2 bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-700">
                <h2 class="text-xl font-semibold mb-4">
                    <i class="fas fa-microscope text-cyan-400 mr-2"></i>AIåˆ†æè¯¦æƒ…
                </h2>
                
                <div class="space-y-4">
                    <div class="grid grid-cols-3 gap-4 mb-6">
                        <div class="p-4 bg-gray-900 rounded-lg text-center">
                            <div class="text-cyan-400 text-sm mb-1">RSIæŒ‡æ•°</div>
                            <div id="aiRsi" class="text-2xl font-bold">--</div>
                            <div id="rsiSignal" class="text-xs mt-1">--</div>
                        </div>
                        <div class="p-4 bg-gray-900 rounded-lg text-center">
                            <div class="text-purple-400 text-sm mb-1">è¶‹åŠ¿å¼ºåº¦</div>
                            <div id="trendStrength" class="text-2xl font-bold">--%</div>
                            <div class="text-xs text-gray-400 mt-1">å¸‚åœºæ–¹å‘</div>
                        </div>
                        <div class="p-4 bg-gray-900 rounded-lg text-center">
                            <div class="text-green-400 text-sm mb-1">æ”¯æ’‘/é˜»åŠ›</div>
                            <div id="srLevel" class="text-xl font-bold">--%</div>
                            <div class="text-xs text-gray-400 mt-1">ä»·æ ¼ä½ç½®</div>
                        </div>
                    </div>
                    
                    <div class="p-4 bg-gray-900 rounded-lg">
                        <div class="text-yellow-400 font-semibold mb-2">
                            <i class="fas fa-lightbulb mr-2"></i>AIå†³ç­–é€»è¾‘
                        </div>
                        <div id="decisionLogic" class="text-sm text-gray-300">
                            æ­£åœ¨åˆ†æå¸‚åœºæ•°æ®ï¼Œè®¡ç®—å¤šæ—¶é—´æ¡†æ¶æŒ‡æ ‡...
                        </div>
                    </div>
                    
                    <div class="p-4 bg-gray-900 rounded-lg">
                        <div class="text-green-400 font-semibold mb-2">
                            <i class="fas fa-chart-pie mr-2"></i>é£é™©è¯„ä¼°
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <div class="text-gray-400 text-sm">é¢„æœŸæ”¶ç›Šç‡</div>
                                <div id="expectedReturn" class="text-lg">1.5-3%</div>
                            </div>
                            <div>
                                <div class="text-gray-400 text-sm">æœ€å¤§é£é™©</div>
                                <div id="maxRisk" class="text-lg">-1.2%</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ä¿¡å·çŠ¶æ€æ§åˆ¶ -->
            <div class="bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-700">
                <h2 class="text-xl font-semibold mb-4">
                    <i class="fas fa-history text-orange-400 mr-2"></i>ä¿¡å·çŠ¶æ€æ§åˆ¶
                </h2>
                
                <div class="space-y-4">
                    <div class="p-4 bg-gray-900 rounded-lg">
                        <div class="text-gray-400 text-sm mb-2">ä¸‹ä¸€ä¸ªä¿¡å·æ¡ä»¶</div>
                        <div class="text-sm text-green-300 mb-1">
                            <i class="fas fa-check-circle mr-1"></i>
                            å½“å‰ä¿¡å·TP/SLè§¦å‘åç”Ÿæˆ
                        </div>
                        <div class="text-xs text-gray-500">
                            é˜²æ­¢ä¿¡å·é‡å ï¼Œæé«˜äº¤æ˜“è´¨é‡
                        </div>
                    </div>
                    
                    <div class="p-4 bg-gray-900 rounded-lg">
                        <div class="flex justify-between items-center mb-3">
                            <div class="text-gray-400">ä¿¡å·ç­‰å¾…æ—¶é—´</div>
                            <div id="signalWaitTime" class="text-xl font-bold text-cyan-400">--:--</div>
                        </div>
                        <div class="w-full bg-gray-700 rounded-full h-2">
                            <div id="waitProgress" class="bg-cyan-500 h-2 rounded-full progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <button onclick="manualCheckTP_SL()" 
                            class="w-full p-3 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold transition-colors">
                        <i class="fas fa-search-dollar mr-2"></i>æ‰‹åŠ¨æ£€æŸ¥TP/SLçŠ¶æ€
                    </button>
                    
                    <button onclick="forceNewSignal()" 
                            class="w-full p-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-semibold transition-colors">
                        <i class="fas fa-bolt mr-2"></i>å¼ºåˆ¶ç”Ÿæˆæ–°ä¿¡å·
                    </button>
                    
                    <div class="text-xs text-gray-500 text-center pt-4">
                        <i class="fas fa-info-circle mr-1"></i>
                        ç­‰å¾…TP/SLè§¦å‘å¯é¿å…è¿‡åº¦äº¤æ˜“
                    </div>
                </div>
            </div>
        </div>

        <!-- å†å²è®°å½• -->
        <div class="bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-700 mb-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold">
                    <i class="fas fa-list-alt text-green-400 mr-2"></i>äº¤æ˜“ä¿¡å·å†å²
                </h2>
                <div class="flex space-x-2">
                    <button onclick="showAllSignals()" class="px-3 py-1 bg-gray-700 rounded text-sm hover:bg-gray-600 transition-colors">å…¨éƒ¨</button>
                    <button onclick="showOnlyProfitable()" class="px-3 py-1 bg-green-700 rounded text-sm hover:bg-green-600 transition-colors">ç›ˆåˆ©</button>
                    <button onclick="exportSignals()" class="px-3 py-1 bg-blue-600 rounded text-sm hover:bg-blue-700 transition-colors">
                        <i class="fas fa-download mr-1"></i>å¯¼å‡º
                    </button>
                    <button onclick="clearHistory()" class="px-3 py-1 bg-red-600 rounded text-sm hover:bg-red-700 transition-colors">
                        <i class="fas fa-trash-alt mr-1"></i>æ¸…ç©º
                    </button>
                </div>
            </div>
            
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b border-gray-700">
                            <th class="py-3 text-left text-gray-400">æ—¶é—´</th>
                            <th class="py-3 text-left text-gray-400">ä¿¡å·</th>
                            <th class="py-3 text-left text-gray-400">å…¥åœºä»·</th>
                            <th class="py-3 text-left text-gray-400">TP1/TP2/SL</th>
                            <th class="py-3 text-left text-gray-400">ä»“ä½(USDT)</th>
                            <th class="py-3 text-left text-gray-400">çŠ¶æ€</th>
                            <th class="py-3 text-left text-gray-400">ç»“æœ</th>
                        </tr>
                    </thead>
                    <tbody id="signalHistory">
                        <tr>
                            <td colspan="7" class="py-8 text-center text-gray-500">
                                <i class="fas fa-chart-line text-3xl mb-2"></i>
                                <div>ç­‰å¾…ç¬¬ä¸€ä¸ªäº¤æ˜“ä¿¡å·ç”Ÿæˆ...</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="mt-6 pt-4 border-t border-gray-700">
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div>
                        <div class="text-gray-400 text-sm">æ€»äº¤æ˜“æ•°</div>
                        <div id="totalTrades" class="text-xl font-bold">0</div>
                    </div>
                    <div>
                        <div class="text-gray-400 text-sm">èƒœç‡</div>
                        <div id="winRate" class="text-xl font-bold text-green-400">0%</div>
                    </div>
                    <div>
                        <div class="text-gray-400 text-sm">æ€»ç›ˆäº</div>
                        <div id="totalPnL" class="text-xl font-bold">$0</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç³»ç»ŸçŠ¶æ€æ ï¼ˆå›ºå®šåœ¨åº•éƒ¨ï¼‰ -->
        <div class="fixed bottom-0 left-0 right-0 bg-gray-800 border-t border-gray-700 p-3">
            <div class="container mx-auto flex justify-between items-center text-sm">
                <div>
                    <span class="text-gray-400">ç³»ç»ŸçŠ¶æ€:</span>
                    <span id="connectionStatus" class="ml-2 text-green-400 blink">
                        <i class="fas fa-circle mr-1"></i>æ­£åœ¨è¿æ¥...
                    </span>
                </div>
                <div>
                    <span class="text-gray-400">APIè°ƒç”¨:</span>
                    <span id="apiCalls" class="ml-2">0</span>
                </div>
                <div>
                    <span class="text-gray-400">æœ€åæ›´æ–°:</span>
                    <span id="lastUpdate" class="ml-2">--:--:--</span>
                </div>
                <div>
                    <span class="text-gray-400">ç‰ˆæœ¬:</span>
                    <span class="ml-2 text-yellow-400">v2.1</span>
                </div>
            </div>
        </div>

        <!-- é¡µè„š -->
        <div class="mt-12 pb-20 text-center text-gray-500 text-sm">
            <p>BTC/USDT AI Trading System v2.1 | å¼ºåŒ–AIåˆ†æ + TP/SLç›‘æ§ç³»ç»Ÿ</p>
            <p class="mt-2">é£é™©æç¤º: æ‰€æœ‰ä¿¡å·ä»…ä¾›å‚è€ƒï¼Œå†å²è¡¨ç°ä¸ä»£è¡¨æœªæ¥ç»“æœï¼ŒæŠ•èµ„éœ€è°¨æ…</p>
            <div class="mt-4 flex justify-center space-x-4">
                <button onclick="refreshAllData()" class="px-4 py-2 bg-yellow-600 rounded hover:bg-yellow-700 transition-colors">
                    <i class="fas fa-sync-alt mr-2"></i>åˆ·æ–°æ•°æ®
                </button>
                <button onclick="resetSystem()" class="px-4 py-2 bg-red-600 rounded hover:bg-red-700 transition-colors">
                    <i class="fas fa-redo mr-2"></i>é‡ç½®ç³»ç»Ÿ
                </button>
                <button onclick="testAPIConnection()" class="px-4 py-2 bg-indigo-600 rounded hover:bg-indigo-700 transition-colors">
                    <i class="fas fa-wifi mr-2"></i>æµ‹è¯•è¿æ¥
                </button>
                <button onclick="showSettings()" class="px-4 py-2 bg-gray-700 rounded hover:bg-gray-600 transition-colors">
                    <i class="fas fa-cog mr-2"></i>è®¾ç½®
                </button>
                <button onclick="startAutoMode()" class="px-4 py-2 bg-green-600 rounded hover:bg-green-700 transition-colors">
                    <i class="fas fa-play mr-2"></i>å¯åŠ¨
                </button>
                <button onclick="stopAutoMode()" class="px-4 py-2 bg-red-600 rounded hover:bg-red-700 transition-colors">
                    <i class="fas fa-stop mr-2"></i>åœæ­¢
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript ä»£ç  -->
    <script>
        // ==================== è‡ªåŠ¨äº¤æ˜“ç³»ç»Ÿä¸»ç±» ====================
        class AutoTradingSystem {
            constructor() {
                // OKX APIé…ç½®
                this.API_BASE = 'https://www.okx.com/api/v5';
                this.currentSymbol = 'BTC-USDT';
                
                // äº¤æ˜“å‚æ•°é…ç½®ï¼ˆä¼˜åŒ–åçš„ä¿å®ˆå‚æ•°ï¼‰
                this.TRADE_CONFIG = {
                    accountBalance: 100,       // USDTæœ¬é‡‘
                    riskPerTrade: 0.02,        // æ¯ç¬”äº¤æ˜“é£é™©2%
                    tp1Percent: 0.015,         // TP1: 1.5% (å¾®åˆ©)
                    tp2Percent: 0.03,          // TP2: 3% (ä¸­åˆ©)
                    slPercent: 0.012,          // SL: 1.2% (å°æŸ)
                    cooldownTime: 180,         // å†·å´æ—¶é—´3åˆ†é’Ÿ
                    maxPositionPercent: 0.5,   // æœ€å¤§ä»“ä½50%
                    minRSI: 28,                // RSIè¶…å–é˜ˆå€¼
                    maxRSI: 72,                // RSIè¶…ä¹°é˜ˆå€¼
                    rsiNeutralMin: 42,         // RSIä¸­æ€§åŒºé—´æœ€å°å€¼
                    rsiNeutralMax: 58,         // RSIä¸­æ€§åŒºé—´æœ€å¤§å€¼
                    highVolatility: 5,         // é«˜æ³¢åŠ¨ç‡é˜ˆå€¼ï¼ˆ%ï¼‰
                    trendThreshold: 0.5        // è¶‹åŠ¿é˜ˆå€¼ï¼ˆ%ï¼‰
                };
                
                // å­˜å‚¨é”®
                this.STORAGE_KEYS = {
                    signals: 'auto_trading_signals_v2',
                    state: 'auto_trading_state_v2',
                    settings: 'auto_trading_settings_v2'
                };
                
                // ç³»ç»ŸçŠ¶æ€
                this.systemState = {
                    lastSignal: null,
                    activeTrade: null,
                    signalHistory: [],
                    stats: {
                        totalTrades: 0,
                        winningTrades: 0,
                        totalPnL: 0,
                        currentStreak: 0,
                        bestStreak: 0,
                        maxWin: 0,
                        maxLoss: 0,
                        avgWin: 0,
                        avgLoss: 0
                    },
                    indicators: {
                        rsi: 50,
                        trend: 'neutral',
                        volatility: 0,
                        support: 0,
                        resistance: 0,
                        pricePosition: 50
                    },
                    lastUpdate: null,
                    cooldownEnd: null,
                    isInitialized: false,
                    apiCallCount: 0
                };
                
                // ä»·æ ¼æ•°æ®
                this.priceData = [];
                this.currentPrice = 0;
                this.chartData = [];
                
                // æ§åˆ¶å˜é‡
                this.isRunning = false;
                this.intervals = {
                    priceUpdate: null,
                    signalCheck: null,
                    chartUpdate: null
                };
                
                // å›¾è¡¨å®ä¾‹
                this.chart = null;
                
                console.log('ğŸš€ AutoTradingSystem åˆå§‹åŒ–');
            }
            
            // åˆå§‹åŒ–ç³»ç»Ÿ
            async init() {
                try {
                    console.log('ğŸ”§ æ­£åœ¨åˆå§‹åŒ–ç³»ç»Ÿ...');
                    this.showSystemStatus('æ­£åœ¨åˆå§‹åŒ–ç³»ç»Ÿ...', 'loading');
                    
                    // åŠ è½½ä¿å­˜çš„çŠ¶æ€
                    this.loadSystemState();
                    
                    // åˆå§‹åŒ–å›¾è¡¨
                    this.initChart();
                    
                    // æµ‹è¯•APIè¿æ¥
                    await this.testAPIConnection();
                    
                    // è·å–åˆå§‹æ•°æ®
                    await this.loadInitialData();
                    
                    // æ›´æ–°æ‰€æœ‰æ˜¾ç¤º
                    this.updateAllDisplays();
                    
                    // å¯åŠ¨è‡ªåŠ¨æ¨¡å¼
                    this.startAutoMode();
                    
                    // æ ‡è®°ä¸ºå·²åˆå§‹åŒ–
                    this.systemState.isInitialized = true;
                    this.saveSystemState();
                    
                    this.showSystemStatus('ç³»ç»Ÿè¿è¡Œæ­£å¸¸', 'success');
                    console.log('âœ… ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ');
                    
                } catch (error) {
                    console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                    this.showSystemStatus('åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
                }
            }
            
            // æµ‹è¯•APIè¿æ¥
            async testAPIConnection() {
                try {
                    const response = await this.fetchWithRetry(`${this.API_BASE}/public/time`);
                    const data = await response.json();
                    
                    if (data.code === '0') {
                        console.log('âœ… OKX APIè¿æ¥æ­£å¸¸');
                        return true;
                    } else {
                        throw new Error(`APIé”™è¯¯: ${data.msg}`);
                    }
                } catch (error) {
                    console.error('APIè¿æ¥æµ‹è¯•å¤±è´¥:', error);
                    throw error;
                }
            }
            
            // å¸¦é‡è¯•çš„fetch
            async fetchWithRetry(url, options = {}, maxRetries = 3) {
                let lastError;
                
                for (let i = 0; i < maxRetries; i++) {
                    try {
                        const response = await fetch(url, options);
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        this.systemState.apiCallCount++;
                        this.updateAPICallsDisplay();
                        return response;
                    } catch (error) {
                        lastError = error;
                        console.log(`é‡è¯• ${i + 1}/${maxRetries}: ${error.message}`);
                        if (i < maxRetries - 1) {
                            await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1)));
                        }
                    }
                }
                
                throw lastError;
            }
            
            // åŠ è½½åˆå§‹æ•°æ®
            async loadInitialData() {
                try {
                    // è·å–å½“å‰ä»·æ ¼
                    const price = await this.getCurrentPrice();
                    if (price) {
                        this.currentPrice = price;
                        this.updatePriceDisplay();
                    }
                    
                    // è·å–Kçº¿æ•°æ®
                    const candles = await this.getCandleData('15m', 30);
                    if (candles.length > 0) {
                        this.processCandleData(candles);
                    }
                    
                    // å¦‚æœæœ‰æ´»è·ƒäº¤æ˜“ï¼Œæ›´æ–°æ˜¾ç¤º
                    if (this.systemState.activeTrade) {
                        this.displaySignal(this.systemState.activeTrade);
                        this.updateTradeStatus('è¿›è¡Œä¸­', 'äº¤æ˜“æ‰§è¡Œä¸­...');
                    }
                    
                } catch (error) {
                    console.error('åŠ è½½åˆå§‹æ•°æ®å¤±è´¥:', error);
                    throw error;
                }
            }
            
            // è·å–å½“å‰ä»·æ ¼
            async getCurrentPrice() {
                try {
                    const response = await this.fetchWithRetry(
                        `${this.API_BASE}/market/ticker?instId=${this.currentSymbol}`
                    );
                    const data = await response.json();
                    
                    if (data.code === '0' && data.data && data.data[0]) {
                        const ticker = data.data[0];
                        const price = parseFloat(ticker.last);
                        
                        // æ›´æ–°ä»·æ ¼æ•°æ®
                        this.currentPrice = price;
                        
                        // æ›´æ–°24å°æ—¶æ•°æ®
                        this.updateMarketData(ticker);
                        
                        return price;
                    } else {
                        throw new Error('æ— æ³•è·å–ä»·æ ¼æ•°æ®');
                    }
                } catch (error) {
                    console.error('è·å–ä»·æ ¼å¤±è´¥:', error.message);
                    return null;
                }
            }
            
            // è·å–Kçº¿æ•°æ®
            async getCandleData(interval = '15m', limit = 30) {
                try {
                    const response = await this.fetchWithRetry(
                        `${this.API_BASE}/market/candles?instId=${this.currentSymbol}&bar=${interval}&limit=${limit}`
                    );
                    const data = await response.json();
                    
                    if (data.code === '0' && data.data) {
                        return data.data.map(candle => ({
                            timestamp: parseInt(candle[0]),
                            open: parseFloat(candle[1]),
                            high: parseFloat(candle[2]),
                            low: parseFloat(candle[3]),
                            close: parseFloat(candle[4]),
                            volume: parseFloat(candle[5])
                        })).reverse();
                    } else {
                        throw new Error('æ— æ³•è·å–Kçº¿æ•°æ®');
                    }
                } catch (error) {
                    console.error('è·å–Kçº¿æ•°æ®å¤±è´¥:', error.message);
                    return [];
                }
            }
            
            // å¤„ç†Kçº¿æ•°æ®
            processCandleData(candles) {
                if (!candles || candles.length < 10) return;
                
                // æ›´æ–°ä»·æ ¼å†å²
                this.chartData = candles.slice(-20).map(candle => ({
                    time: new Date(candle.timestamp).toLocaleTimeString('zh-CN', {
                        hour: '2-digit',
                        minute: '2-digit'
                    }),
                    price: candle.close
                }));
                
                // è®¡ç®—æŠ€æœ¯æŒ‡æ ‡
                this.calculateIndicators(candles);
                
                // æ›´æ–°å›¾è¡¨
                this.updateChart();
            }
            
            // è®¡ç®—æŠ€æœ¯æŒ‡æ ‡
            calculateIndicators(candles) {
                const closes = candles.map(c => c.close);
                const highs = candles.map(c => c.high);
                const lows = candles.map(c => c.low);
                
                // è®¡ç®—RSI
                const rsi = this.calculateRSI(closes);
                
                // è®¡ç®—æ”¯æ’‘é˜»åŠ›ä½
                const sr = this.calculateSupportResistance(highs, lows, this.currentPrice);
                
                // è®¡ç®—è¶‹åŠ¿
                const trend = this.calculateTrend(closes);
                
                // è®¡ç®—æ³¢åŠ¨ç‡
                const volatility = this.calculateVolatility(closes);
                
                // æ›´æ–°æŒ‡æ ‡
                this.systemState.indicators = {
                    rsi,
                    trend,
                    volatility,
                    support: sr.support,
                    resistance: sr.resistance,
                    pricePosition: sr.pricePosition,
                    distanceToResistance: sr.distanceToResistance,
                    distanceToSupport: sr.distanceToSupport
                };
                
                // æ›´æ–°æŒ‡æ ‡æ˜¾ç¤º
                this.updateIndicatorsDisplay();
            }
            
            // è®¡ç®—RSI
            calculateRSI(closes) {
                if (closes.length < 14) return 50;
                
                let gains = 0;
                let losses = 0;
                
                // è®¡ç®—åˆå§‹å¹³å‡å€¼
                for (let i = 1; i < 14; i++) {
                    const change = closes[i] - closes[i - 1];
                    if (change > 0) {
                        gains += change;
                    } else {
                        losses += Math.abs(change);
                    }
                }
                
                let avgGain = gains / 13;
                let avgLoss = losses / 13;
                
                // è®¡ç®—åç»­å€¼
                for (let i = 14; i < closes.length; i++) {
                    const change = closes[i] - closes[i - 1];
                    const gain = change > 0 ? change : 0;
                    const loss = change < 0 ? Math.abs(change) : 0;
                    
                    avgGain = (avgGain * 13 + gain) / 14;
                    avgLoss = (avgLoss * 13 + loss) / 14;
                }
                
                if (avgLoss === 0) return 100;
                const rs = avgGain / avgLoss;
                return 100 - (100 / (1 + rs));
            }
            
            // è®¡ç®—æ”¯æ’‘é˜»åŠ›ä½
            calculateSupportResistance(highs, lows, currentPrice) {
                const recentHighs = highs.slice(-20);
                const recentLows = lows.slice(-20);
                
                const resistance = Math.max(...recentHighs);
                const support = Math.min(...recentLows);
                
                let pricePosition = 50;
                if (resistance > support) {
                    pricePosition = ((currentPrice - support) / (resistance - support) * 100);
                }
                
                return {
                    support,
                    resistance,
                    pricePosition: Math.max(0, Math.min(100, pricePosition)),
                    distanceToResistance: ((resistance - currentPrice) / currentPrice * 100).toFixed(2),
                    distanceToSupport: ((currentPrice - support) / currentPrice * 100).toFixed(2)
                };
            }
            
            // è®¡ç®—è¶‹åŠ¿
            calculateTrend(closes) {
                if (closes.length < 10) return 'neutral';
                
                const shortTerm = closes.slice(-5);
                const longTerm = closes.slice(-10);
                
                const shortAvg = shortTerm.reduce((a, b) => a + b) / shortTerm.length;
                const longAvg = longTerm.reduce((a, b) => a + b) / longTerm.length;
                
                const change = ((shortAvg - longAvg) / longAvg) * 100;
                
                if (change > this.TRADE_CONFIG.trendThreshold) return 'bullish';
                if (change < -this.TRADE_CONFIG.trendThreshold) return 'bearish';
                return 'neutral';
            }
            
            // è®¡ç®—æ³¢åŠ¨ç‡
            calculateVolatility(closes) {
                if (closes.length < 10) return 0;
                
                const returns = [];
                for (let i = 1; i < closes.length; i++) {
                    returns.push((closes[i] - closes[i-1]) / closes[i-1]);
                }
                
                const mean = returns.reduce((a, b) => a + b) / returns.length;
                const variance = returns.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / returns.length;
                
                return Math.sqrt(variance) * Math.sqrt(252) * 100;
            }
            
            // ç”Ÿæˆäº¤æ˜“ä¿¡å·
            async generateSignal() {
                // æ£€æŸ¥æ˜¯å¦åœ¨å†·å´æœŸ
                if (this.isInCooldown()) {
                    console.log('â³ å†·å´æœŸï¼Œè·³è¿‡ä¿¡å·ç”Ÿæˆ');
                    this.updateCooldownDisplay();
                    return;
                }
                
                // æ£€æŸ¥æ˜¯å¦æœ‰æ´»è·ƒäº¤æ˜“
                if (this.systemState.activeTrade) {
                    console.log('ğŸ”„ æœ‰æ´»è·ƒäº¤æ˜“ï¼Œç­‰å¾…å®Œæˆ');
                    return;
                }
                
                console.log('ğŸ” å¼€å§‹åˆ†æå¸‚åœºï¼Œç”Ÿæˆä¿¡å·...');
                this.showSystemStatus('åˆ†æå¸‚åœºæ•°æ®ä¸­...', 'loading');
                
                try {
                    // è·å–å½“å‰ä»·æ ¼
                    const price = await this.getCurrentPrice();
                    if (!price) {
                        this.showSystemStatus('è·å–ä»·æ ¼å¤±è´¥', 'error');
                        return;
                    }
                    
                    // è·å–Kçº¿æ•°æ®
                    const candles = await this.getCandleData('15m', 30);
                    if (candles.length < 20) {
                        this.showSystemStatus('æ•°æ®ä¸è¶³ï¼Œæ— æ³•åˆ†æ', 'warning');
                        return;
                    }
                    
                    // é‡æ–°è®¡ç®—æŒ‡æ ‡
                    this.calculateIndicators(candles);
                    
                    // åˆ†æå¸‚åœº
                    const signal = this.analyzeMarket();
                    
                    // å¦‚æœæœ‰äº¤æ˜“ä¿¡å·
                    if (signal.action !== 'HOLD') {
                        // åˆ›å»ºäº¤æ˜“è®°å½•
                        const trade = this.createTradeRecord(signal, price);
                        
                        // è®¾ç½®æ´»è·ƒäº¤æ˜“
                        this.systemState.activeTrade = trade;
                        this.systemState.lastSignal = trade;
                        
                        // æ·»åŠ åˆ°å†å²
                        this.addToHistory(trade);
                        
                        // æ›´æ–°UI
                        this.displaySignal(trade);
                        this.updateTradeStatus('è¿›è¡Œä¸­', `æ–°ä¿¡å·: ${trade.action}`);
                        
                        // ä¿å­˜çŠ¶æ€
                        this.saveSystemState();
                        
                        this.showSystemStatus(`æ–°ä¿¡å·ç”Ÿæˆ: ${trade.action}`, 'success');
                        console.log(`âœ… ä¿¡å·ç”Ÿæˆ: ${trade.action}, ä»·æ ¼: $${price}, RSI: ${this.systemState.indicators.rsi.toFixed(1)}`);
                        
                    } else {
                        this.updateTradeStatus('è§‚æœ›', signal.reason);
                        this.showSystemStatus('å¸‚åœºæ¡ä»¶ä¸é€‚åˆäº¤æ˜“', 'info');
                        console.log('â¸ï¸ æ— äº¤æ˜“ä¿¡å·:', signal.reason);
                    }
                    
                } catch (error) {
                    console.error('ç”Ÿæˆä¿¡å·å¤±è´¥:', error);
                    this.showSystemStatus('ç”Ÿæˆä¿¡å·å¤±è´¥', 'error');
                }
            }
            
            // åˆ†æå¸‚åœº
            analyzeMarket() {
                const indicators = this.systemState.indicators;
                const { rsi, trend, volatility, pricePosition } = indicators;
                
                let action = 'HOLD';
                let confidence = 0.5;
                let reason = '';
                
                // RSIä¿¡å·
                if (rsi < this.TRADE_CONFIG.minRSI) {
                    // RSIè¶…å–ï¼Œå¯èƒ½ä¹°å…¥æœºä¼š
                    if (trend === 'bullish' || trend === 'neutral') {
                        action = 'BUY';
                        confidence = 0.7 + (this.TRADE_CONFIG.minRSI - rsi) / 50;
                        reason = `RSIè¶…å–(${rsi.toFixed(1)} < ${this.TRADE_CONFIG.minRSI})ï¼Œè¶‹åŠ¿${trend === 'bullish' ? 'å‘ä¸Š' : 'ä¸­æ€§'}`;
                        
                        if (pricePosition < 40) {
                            reason += `ï¼Œä»·æ ¼æ¥è¿‘æ”¯æ’‘ä½(${pricePosition.toFixed(1)}%)`;
                            confidence += 0.05;
                        }
                    } else {
                        reason = `RSIè¶…å–(${rsi.toFixed(1)})ä½†è¶‹åŠ¿å‘ä¸‹ï¼Œç­‰å¾…ç¡®è®¤`;
                    }
                    
                } else if (rsi > this.TRADE_CONFIG.maxRSI) {
                    // RSIè¶…ä¹°ï¼Œå¯èƒ½å–å‡ºæœºä¼š
                    if (trend === 'bearish' || trend === 'neutral') {
                        action = 'SELL';
                        confidence = 0.7 + (rsi - this.TRADE_CONFIG.maxRSI) / 50;
                        reason = `RSIè¶…ä¹°(${rsi.toFixed(1)} > ${this.TRADE_CONFIG.maxRSI})ï¼Œè¶‹åŠ¿${trend === 'bearish' ? 'å‘ä¸‹' : 'ä¸­æ€§'}`;
                        
                        if (pricePosition > 60) {
                            reason += `ï¼Œä»·æ ¼æ¥è¿‘é˜»åŠ›ä½(${pricePosition.toFixed(1)}%)`;
                            confidence += 0.05;
                        }
                    } else {
                        reason = `RSIè¶…ä¹°(${rsi.toFixed(1)})ä½†è¶‹åŠ¿å‘ä¸Šï¼Œç­‰å¾…ç¡®è®¤`;
                    }
                    
                } else if (rsi > this.TRADE_CONFIG.rsiNeutralMin && rsi < this.TRADE_CONFIG.rsiNeutralMax) {
                    // RSIä¸­æ€§åŒºé—´
                    reason = `RSIä¸­æ€§(${rsi.toFixed(1)})ï¼Œå¸‚åœºå¹³è¡¡`;
                    confidence = 0.6;
                    
                } else {
                    // RSIåœ¨æ­£å¸¸åŒºé—´
                    if (pricePosition < 30 && trend !== 'bearish') {
                        action = 'BUY';
                        confidence = 0.65;
                        reason = `ä»·æ ¼æ¥è¿‘æ”¯æ’‘ä½(${pricePosition.toFixed(1)}%)ï¼ŒRSIé€‚ä¸­(${rsi.toFixed(1)})`;
                    } else if (pricePosition > 70 && trend !== 'bullish') {
                        action = 'SELL';
                        confidence = 0.65;
                        reason = `ä»·æ ¼æ¥è¿‘é˜»åŠ›ä½(${pricePosition.toFixed(1)}%)ï¼ŒRSIé€‚ä¸­(${rsi.toFixed(1)})`;
                    } else {
                        reason = `å¸‚åœºæ— æ˜æ˜¾ä¿¡å·ï¼ŒRSI: ${rsi.toFixed(1)}ï¼Œä½ç½®: ${pricePosition.toFixed(1)}%ï¼Œè¶‹åŠ¿: ${trend}`;
                    }
                }
                
                // æ³¢åŠ¨ç‡è¿‡æ»¤
                if (volatility > this.TRADE_CONFIG.highVolatility) {
                    confidence *= 0.8;
                    reason += ` | é«˜æ³¢åŠ¨ç‡(${volatility.toFixed(1)}%)é™ä½ä¿¡å·å¼ºåº¦`;
                }
                
                // é™åˆ¶ç½®ä¿¡åº¦èŒƒå›´
                confidence = Math.max(0.3, Math.min(0.95, confidence));
                
                return {
                    action,
                    confidence: confidence.toFixed(2),
                    reason,
                    rsi: rsi.toFixed(2),
                    trend,
                    volatility: volatility.toFixed(1),
                    pricePosition: pricePosition.toFixed(1)
                };
            }
            
            // åˆ›å»ºäº¤æ˜“è®°å½•
            createTradeRecord(signal, price) {
                // è®¡ç®—äº¤æ˜“å‚æ•°
                const params = this.calculateTradeParams(signal.action, price, parseFloat(signal.confidence));
                
                // ç”Ÿæˆå”¯ä¸€ID
                const id = `trade_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                
                return {
                    id,
                    action: signal.action,
                    confidence: signal.confidence,
                    price: price.toFixed(2),
                    tp1: params.tp1.toFixed(2),
                    tp2: params.tp2.toFixed(2),
                    sl: params.sl.toFixed(2),
                    positionSize: params.positionSize,
                    positionPercent: params.positionPercent,
                    riskReward: params.riskReward,
                    reason: signal.reason,
                    rsi: signal.rsi,
                    symbol: this.currentSymbol,
                    timestamp: new Date().toISOString(),
                    status: 'active',
                    result: null,
                    pnl: null,
                    exitPrice: null,
                    completedAt: null
                };
            }
            
            // è®¡ç®—äº¤æ˜“å‚æ•°
            calculateTradeParams(action, price, confidence) {
                let tp1, tp2, sl;
                
                // è®¡ç®—TP/SL
                if (action === 'BUY') {
                    tp1 = price * (1 + this.TRADE_CONFIG.tp1Percent);
                    tp2 = price * (1 + this.TRADE_CONFIG.tp2Percent);
                    sl = price * (1 - this.TRADE_CONFIG.slPercent);
                } else if (action === 'SELL') {
                    tp1 = price * (1 - this.TRADE_CONFIG.tp1Percent);
                    tp2 = price * (1 - this.TRADE_CONFIG.tp2Percent);
                    sl = price * (1 + this.TRADE_CONFIG.slPercent);
                }
                
                // è®¡ç®—é£é™©å›æŠ¥æ¯”
                const risk = Math.abs(price - sl);
                const reward = Math.abs(tp1 - price);
                const riskReward = (reward / risk).toFixed(2);
                
                // è®¡ç®—å»ºè®®ä»“ä½
                const riskAmount = this.TRADE_CONFIG.accountBalance * this.TRADE_CONFIG.riskPerTrade;
                const positionSize = Math.min(
                    (riskAmount / (risk / price)),
                    this.TRADE_CONFIG.accountBalance * this.TRADE_CONFIG.maxPositionPercent
                );
                const positionPercent = ((positionSize / this.TRADE_CONFIG.accountBalance) * 100).toFixed(1);
                
                return {
                    tp1,
                    tp2,
                    sl,
                    riskReward,
                    positionSize: positionSize.toFixed(2),
                    positionPercent
                };
            }
            
            // æ£€æŸ¥äº¤æ˜“æ¡ä»¶
            checkTradeConditions() {
                if (!this.systemState.activeTrade || !this.currentPrice) return;
                
                const trade = this.systemState.activeTrade;
                const price = parseFloat(trade.price);
                const current = this.currentPrice;
                const tp1 = parseFloat(trade.tp1);
                const tp2 = parseFloat(trade.tp2);
                const sl = parseFloat(trade.sl);
                
                let triggered = false;
                let result = null;
                let tpLevel = 0;
                
                if (trade.action === 'BUY') {
                    if (current >= tp2) {
                        result = 'win';
                        tpLevel = 2;
                        triggered = true;
                    } else if (current >= tp1) {
                        result = 'win';
                        tpLevel = 1;
                        triggered = true;
                    } else if (current <= sl) {
                        result = 'loss';
                        triggered = true;
                    }
                } else if (trade.action === 'SELL') {
                    if (current <= tp2) {
                        result = 'win';
                        tpLevel = 2;
                        triggered = true;
                    } else if (current <= tp1) {
                        result = 'win';
                        tpLevel = 1;
                        triggered = true;
                    } else if (current >= sl) {
                        result = 'loss';
                        triggered = true;
                    }
                }
                
                if (triggered) {
                    this.completeTrade(result, tpLevel, current);
                } else {
                    this.updateDistanceDisplay(trade, current);
                }
            }
            
            // å®Œæˆäº¤æ˜“
            completeTrade(result, tpLevel, currentPrice) {
                const trade = this.systemState.activeTrade;
                
                // è®¡ç®—ç›ˆäº
                const positionSize = parseFloat(trade.positionSize);
                const entry = parseFloat(trade.price);
                let pnl = 0;
                
                if (result === 'win') {
                    const tpPrice = tpLevel === 1 ? parseFloat(trade.tp1) : parseFloat(trade.tp2);
                    
                    if (trade.action === 'BUY') {
                        pnl = (tpPrice - entry) * (positionSize / entry);
                    } else {
                        pnl = (entry - tpPrice) * (positionSize / entry);
                    }
                } else {
                    const slPrice = parseFloat(trade.sl);
                    if (trade.action === 'BUY') {
                        pnl = (slPrice - entry) * (positionSize / entry);
                    } else {
                        pnl = (entry - slPrice) * (positionSize / entry);
                    }
                }
                
                // æ›´æ–°äº¤æ˜“è®°å½•
                trade.status = result === 'win' ? 
                    (tpLevel === 1 ? 'hit_tp1' : 'hit_tp2') : 
                    'hit_sl';
                trade.result = result;
                trade.pnl = pnl.toFixed(2);
                trade.exitPrice = currentPrice.toFixed(2);
                trade.completedAt = new Date().toISOString();
                
                // æ›´æ–°ç»Ÿè®¡æ•°æ®
                this.updateStats(result, pnl);
                
                // æ˜¾ç¤ºç»“æœ
                const resultText = result === 'win' ? 
                    `${tpLevel === 2 ? 'ç¬¬äºŒæ­¢ç›ˆ' : 'ç¬¬ä¸€æ­¢ç›ˆ'}è¾¾æˆï¼Œç›ˆåˆ© $${pnl.toFixed(2)}` :
                    `æ­¢æŸè§¦å‘ï¼ŒäºæŸ $${Math.abs(pnl).toFixed(2)}`;
                
                this.updateTradeStatus('å·²å®Œæˆ', resultText);
                
                // é«˜äº®æ˜¾ç¤º
                this.highlightTradeResult(result, tpLevel);
                
                // æ¸…é™¤æ´»è·ƒäº¤æ˜“
                this.systemState.activeTrade = null;
                
                // ä¿å­˜çŠ¶æ€
                this.saveSystemState();
                
                // æ˜¾ç¤ºé€šçŸ¥
                this.showSystemStatus(`äº¤æ˜“å®Œæˆ: ${resultText}`, result === 'win' ? 'success' : 'error');
                
                // å¼€å§‹å†·å´æ—¶é—´
                this.startCooldownPeriod();
                
                console.log(`ğŸ¯ äº¤æ˜“å®Œæˆ: ${result}, PnL: $${pnl.toFixed(2)}`);
            }
            
            // æ›´æ–°ç»Ÿè®¡æ•°æ®
            updateStats(result, pnl) {
                const stats = this.systemState.stats;
                
                stats.totalTrades++;
                
                if (result === 'win') {
                    stats.winningTrades++;
                    stats.currentStreak++;
                    
                    if (stats.currentStreak > stats.bestStreak) {
                        stats.bestStreak = stats.currentStreak;
                    }
                    
                    // æ›´æ–°æœ€å¤§ç›ˆåˆ©
                    if (pnl > stats.maxWin) {
                        stats.maxWin = pnl;
                    }
                    
                    // æ›´æ–°å¹³å‡ç›ˆåˆ©
                    const winCount = stats.winningTrades - 1;
                    stats.avgWin = winCount > 0 ? 
                        ((stats.avgWin * winCount) + pnl) / stats.winningTrades : 
                        pnl;
                        
                } else {
                    stats.currentStreak = 0;
                    
                    // æ›´æ–°æœ€å¤§äºæŸ
                    if (pnl < stats.maxLoss) {
                        stats.maxLoss = pnl;
                    }
                    
                    // æ›´æ–°å¹³å‡äºæŸ
                    const lossCount = (stats.totalTrades - stats.winningTrades) - 1;
                    stats.avgLoss = lossCount > 0 ? 
                        ((stats.avgLoss * lossCount) + pnl) / (stats.totalTrades - stats.winningTrades) : 
                        pnl;
                }
                
                stats.totalPnL += pnl;
                
                // æ›´æ–°æ˜¾ç¤º
                this.updateStatsDisplay();
            }
            
            // ==================== UIæ›´æ–°æ–¹æ³• ====================
            
            // æ˜¾ç¤ºç³»ç»ŸçŠ¶æ€
            showSystemStatus(message, type = 'info') {
                const statusElement = document.getElementById('systemStatus');
                if (!statusElement) return;
                
                const colors = {
                    info: 'text-blue-400',
                    success: 'text-green-400',
                    warning: 'text-yellow-400',
                    error: 'text-red-400',
                    loading: 'text-purple-400'
                };
                
                const icons = {
                    info: 'â„¹ï¸',
                    success: 'âœ…',
                    warning: 'âš ï¸',
                    error: 'âŒ',
                    loading: 'â³'
                };
                
                statusElement.innerHTML = `${icons[type] || ''} ${message}`;
                statusElement.className = colors[type] || colors.info;
                
                console.log(`ç³»ç»ŸçŠ¶æ€: ${message}`);
            }
            
            // æ›´æ–°ä»·æ ¼æ˜¾ç¤º
            updatePriceDisplay() {
                const priceElement = document.getElementById('priceDisplay');
                const timeElement = document.getElementById('updateTime');
                const monitorElement = document.getElementById('monitorCurrent');
                
                if (priceElement) {
                    priceElement.textContent = `$${this.currentPrice.toLocaleString('en-US', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    })}`;
                }
                
                if (timeElement) {
                    timeElement.textContent = new Date().toLocaleTimeString('zh-CN');
                }
                
                if (monitorElement) {
                    monitorElement.textContent = `$${this.currentPrice.toLocaleString('en-US', {
                        minimumFractionDigits: 2
                    })}`;
                }
            }
            
            // æ›´æ–°å¸‚åœºæ•°æ®
            updateMarketData(ticker) {
                const highElement = document.getElementById('high24h');
                const lowElement = document.getElementById('low24h');
                
                if (highElement && ticker.high24h) {
                    highElement.textContent = `$${parseFloat(ticker.high24h).toLocaleString('en-US', {
                        minimumFractionDigits: 2
                    })}`;
                }
                
                if (lowElement && ticker.low24h) {
                    lowElement.textContent = `$${parseFloat(ticker.low24h).toLocaleString('en-US', {
                        minimumFractionDigits: 2
                    })}`;
                }
            }
            
            // æ›´æ–°æŒ‡æ ‡æ˜¾ç¤º
            updateIndicatorsDisplay() {
                const indicators = this.systemState.indicators;
                
                // RSIæ˜¾ç¤º
                const rsiElement = document.getElementById('aiRsi');
                const rsiSignalElement = document.getElementById('rsiSignal');
                
                if (rsiElement) {
                    rsiElement.textContent = indicators.rsi.toFixed(2);
                    
                    if (indicators.rsi < this.TRADE_CONFIG.minRSI) {
                        rsiElement.className = 'text-2xl font-bold text-green-400';
                        if (rsiSignalElement) {
                            rsiSignalElement.textContent = 'è¶…å–';
                            rsiSignalElement.className = 'text-xs text-green-400 mt-1';
                        }
                    } else if (indicators.rsi > this.TRADE_CONFIG.maxRSI) {
                        rsiElement.className = 'text-2xl font-bold text-red-400';
                        if (rsiSignalElement) {
                            rsiSignalElement.textContent = 'è¶…ä¹°';
                            rsiSignalElement.className = 'text-xs text-red-400 mt-1';
                        }
                    } else {
                        rsiElement.className = 'text-2xl font-bold text-yellow-400';
                        if (rsiSignalElement) {
                            rsiSignalElement.textContent = 'ä¸­æ€§';
                            rsiSignalElement.className = 'text-xs text-yellow-400 mt-1';
                        }
                    }
                }
                
                // è¶‹åŠ¿å¼ºåº¦
                const trendElement = document.getElementById('trendStrength');
                if (trendElement) {
                    let strength = 50;
                    if (indicators.trend === 'bullish') strength = 75;
                    if (indicators.trend === 'bearish') strength = 25;
                    
                    trendElement.textContent = `${strength}%`;
                    
                    if (strength > 60) {
                        trendElement.className = 'text-2xl font-bold text-green-400';
                    } else if (strength < 40) {
                        trendElement.className = 'text-2xl font-bold text-red-400';
                    } else {
                        trendElement.className = 'text-2xl font-bold text-yellow-400';
                    }
                }
                
                // æ”¯æ’‘é˜»åŠ›ä½
                const srElement = document.getElementById('srLevel');
                if (srElement) {
                    srElement.textContent = `${indicators.pricePosition.toFixed(1)}%`;
                }
                
                // æ›´æ–°åˆ†ææ–‡æœ¬
                const analysisElement = document.getElementById('analysisText');
                const decisionElement = document.getElementById('decisionLogic');
                
                if (analysisElement) {
                    analysisElement.textContent = `RSI: ${indicators.rsi.toFixed(1)} | è¶‹åŠ¿: ${indicators.trend} | ä½ç½®: ${indicators.pricePosition.toFixed(1)}%`;
                }
                
                if (decisionElement) {
                    if (indicators.rsi < this.TRADE_CONFIG.minRSI) {
                        decisionElement.textContent = 'RSIè¶…å–ï¼Œå…³æ³¨ä¹°å…¥æœºä¼š';
                    } else if (indicators.rsi > this.TRADE_CONFIG.maxRSI) {
                        decisionElement.textContent = 'RSIè¶…ä¹°ï¼Œå…³æ³¨å–å‡ºæœºä¼š';
                    } else {
                        decisionElement.textContent = 'RSIä¸­æ€§ï¼Œç­‰å¾…æ˜ç¡®ä¿¡å·';
                    }
                }
            }
            
            // æ˜¾ç¤ºä¿¡å·
            displaySignal(signal) {
                if (!signal) return;
                
                const card = document.getElementById('signalCard');
                const actionElement = document.getElementById('signalAction');
                const confidenceElement = document.getElementById('signalConfidence');
                const timeElement = document.getElementById('signalTime');
                const analysisElement = document.getElementById('analysisText');
                
                // è®¾ç½®å¡ç‰‡æ ·å¼
                if (card) {
                    card.className = 'rounded-xl p-6 shadow-lg border-2';
                    
                    if (signal.action === 'BUY') {
                        card.classList.add('signal-buy');
                        if (actionElement) {
                            actionElement.innerHTML = 'ğŸ”¼ BUY';
                            actionElement.className = 'text-5xl font-bold text-green-400 mb-4';
                        }
                    } else if (signal.action === 'SELL') {
                        card.classList.add('signal-sell');
                        if (actionElement) {
                            actionElement.innerHTML = 'ğŸ”½ SELL';
                            actionElement.className = 'text-5xl font-bold text-red-400 mb-4';
                        }
                    } else {
                        card.classList.add('signal-hold');
                        if (actionElement) {
                            actionElement.textContent = 'â¸ï¸ HOLD';
                            actionElement.className = 'text-5xl font-bold text-gray-400 mb-4';
                        }
                    }
                }
                
                // æ›´æ–°ä¿¡å·ä¿¡æ¯
                if (confidenceElement) {
                    confidenceElement.textContent = `${(parseFloat(signal.confidence) * 100).toFixed(0)}%`;
                }
                
                if (timeElement && signal.timestamp) {
                    timeElement.textContent = `ç”Ÿæˆ: ${new Date(signal.timestamp).toLocaleTimeString('zh-CN', { 
                        hour: '2-digit', 
                        minute: '2-digit',
                        second: '2-digit'
                    })}`;
                }
                
                if (analysisElement) {
                    analysisElement.textContent = signal.reason || 'AIåˆ†æå®Œæˆ';
                }
                
                // æ›´æ–°äº¤æ˜“å‚æ•°
                const entryPriceElement = document.getElementById('entryPrice');
                const tp1Element = document.getElementById('takeProfit1');
                const tp2Element = document.getElementById('takeProfit2');
                const slElement = document.getElementById('stopLoss');
                const riskRewardElement = document.getElementById('riskReward');
                const positionSizeElement = document.getElementById('positionSize');
                const positionPercentElement = document.getElementById('positionPercent');
                
                if (entryPriceElement) entryPriceElement.textContent = `$${signal.price}`;
                if (tp1Element) tp1Element.textContent = `$${signal.tp1}`;
                if (tp2Element) tp2Element.textContent = `$${signal.tp2}`;
                if (slElement) slElement.textContent = `$${signal.sl}`;
                if (riskRewardElement) riskRewardElement.textContent = `${signal.riskReward}:1`;
                if (positionSizeElement) positionSizeElement.textContent = `${signal.positionSize} USDT`;
                if (positionPercentElement) positionPercentElement.textContent = `${signal.positionPercent}%`;
            }
            
            // æ›´æ–°è·ç¦»æ˜¾ç¤º
            updateDistanceDisplay(trade, currentPrice) {
                const entry = parseFloat(trade.price);
                const tp1 = parseFloat(trade.tp1);
                const sl = parseFloat(trade.sl);
                
                let distanceTP1, distanceSL;
                
                if (trade.action === 'BUY') {
                    distanceTP1 = ((currentPrice - entry) / entry * 100).toFixed(2);
                    distanceSL = ((entry - currentPrice) / entry * 100).toFixed(2);
                } else {
                    distanceTP1 = ((entry - currentPrice) / entry * 100).toFixed(2);
                    distanceSL = ((currentPrice - entry) / entry * 100).toFixed(2);
                }
                
                // æ›´æ–°UIå…ƒç´ 
                const tp1Element = document.getElementById('distanceTP1');
                const slElement = document.getElementById('distanceSL');
                const progressElement = document.getElementById('priceProgress');
                
                if (tp1Element) {
                    tp1Element.textContent = `${distanceTP1}%`;
                    tp1Element.className = distanceTP1 > 0 ? 
                        'text-xl font-bold text-green-400' : 
                        'text-xl font-bold text-red-400';
                }
                
                if (slElement) {
                    slElement.textContent = `${distanceSL}%`;
                    slElement.className = distanceSL > 0 ? 
                        'text-xl font-bold text-red-400' : 
                        'text-xl font-bold text-green-400';
                }
                
                // æ›´æ–°è¿›åº¦æ¡
                if (progressElement) {
                    const totalRange = Math.abs(tp1 - sl);
                    const currentPosition = Math.abs(currentPrice - sl);
                    const progress = (currentPosition / totalRange * 100);
                    progressElement.style.width = `${Math.min(Math.max(progress, 0), 100)}%`;
                }
            }
            
            // æ›´æ–°å†·å´æ—¶é—´æ˜¾ç¤º
            updateCooldownDisplay() {
                if (!this.isInCooldown()) {
                    const timeElement = document.getElementById('signalWaitTime');
                    const progressElement = document.getElementById('waitProgress');
                    const statusElement = document.getElementById('statusMessage');
                    
                    if (timeElement) timeElement.textContent = 'å°±ç»ª';
                    if (progressElement) progressElement.style.width = '100%';
                    if (statusElement) statusElement.textContent = 'å¯ä»¥ç”Ÿæˆæ–°ä¿¡å·ï¼';
                    return;
                }
                
                const remaining = this.systemState.cooldownEnd - new Date();
                const seconds = Math.floor(remaining / 1000);
                const minutes = Math.floor(seconds / 60);
                const secs = seconds % 60;
                
                const timeElement = document.getElementById('signalWaitTime');
                const progressElement = document.getElementById('waitProgress');
                const statusElement = document.getElementById('statusMessage');
                
                if (timeElement) {
                    timeElement.textContent = `${minutes}:${secs.toString().padStart(2, '0')}`;
                }
                
                if (progressElement) {
                    const progress = ((this.TRADE_CONFIG.cooldownTime * 1000 - remaining) / (this.TRADE_CONFIG.cooldownTime * 1000) * 100);
                    progressElement.style.width = `${progress}%`;
                }
                
                if (statusElement) {
                    statusElement.textContent = `ç­‰å¾…æ–°ä¿¡å· (${minutes}:${secs.toString().padStart(2, '0')})`;
                }
                
                // æ¯ç§’æ›´æ–°ä¸€æ¬¡
                if (remaining > 1000) {
                    setTimeout(() => this.updateCooldownDisplay(), 1000);
                }
            }
            
            // æ›´æ–°äº¤æ˜“çŠ¶æ€
            updateTradeStatus(status, message) {
                const statusElement = document.getElementById('tradeStatus');
                const messageElement = document.getElementById('statusMessage');
                
                if (statusElement) {
                    statusElement.textContent = status;
                    statusElement.className = 'px-3 py-1 rounded-full';
                    
                    if (status === 'è¿›è¡Œä¸­') {
                        statusElement.classList.add('bg-yellow-900', 'text-yellow-300');
                    } else if (status === 'å·²å®Œæˆ') {
                        statusElement.classList.add('bg-green-900', 'text-green-300');
                    } else if (status === 'è§‚æœ›') {
                        statusElement.classList.add('bg-gray-700', 'text-gray-300');
                    }
                }
                
                if (messageElement) {
                    messageElement.textContent = message;
                }
            }
            
            // é«˜äº®äº¤æ˜“ç»“æœ
            highlightTradeResult(result, tpLevel) {
                const signalCard = document.getElementById('signalCard');
                if (!signalCard) return;
                
                signalCard.classList.add('price-hit');
                
                if (result === 'win') {
                    signalCard.style.borderColor = '#10b981';
                    signalCard.style.boxShadow = '0 0 20px rgba(16, 185, 129, 0.5)';
                } else {
                    signalCard.style.borderColor = '#ef4444';
                    signalCard.style.boxShadow = '0 0 20px rgba(239, 68, 68, 0.5)';
                }
                
                // 3ç§’åç§»é™¤é«˜äº®
                setTimeout(() => {
                    signalCard.classList.remove('price-hit');
                    signalCard.style.boxShadow = '';
                }, 3000);
            }
            
            // æ·»åŠ åˆ°å†å²
            addToHistory(signal) {
                this.systemState.signalHistory.unshift(signal);
                
                // ä¿æŒæœ€å¤š20æ¡è®°å½•
                if (this.systemState.signalHistory.length > 20) {
                    this.systemState.signalHistory = this.systemState.signalHistory.slice(0, 20);
                }
                
                // æ›´æ–°æ˜¾ç¤º
                this.updateHistoryTable();
                this.updateStatsDisplay();
            }
            
            // æ›´æ–°å†å²è¡¨æ ¼
            updateHistoryTable() {
                const tbody = document.getElementById('signalHistory');
                if (!tbody) return;
                
                if (this.systemState.signalHistory.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" class="py-8 text-center text-gray-500">
                                <i class="fas fa-chart-line text-3xl mb-2"></i>
                                <div>ç­‰å¾…ç¬¬ä¸€ä¸ªäº¤æ˜“ä¿¡å·ç”Ÿæˆ...</div>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                tbody.innerHTML = this.systemState.signalHistory.map(signal => {
                    const time = new Date(signal.timestamp).toLocaleTimeString('zh-CN', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    const actionClass = signal.action === 'BUY' ? 'text-green-400' : 
                                      signal.action === 'SELL' ? 'text-red-400' : 'text-gray-400';
                    
                    const actionIcon = signal.action === 'BUY' ? 'ğŸ“ˆ' : 
                                     signal.action === 'SELL' ? 'ğŸ“‰' : 'â¸ï¸';
                    
                    let statusClass = 'text-gray-400';
                    let statusText = 'ç­‰å¾…';
                    
                    if (signal.status === 'hit_tp1' || signal.status === 'hit_tp2') {
                        statusClass = 'text-green-400';
                        statusText = signal.status === 'hit_tp1' ? 'TP1è¾¾æˆ' : 'TP2è¾¾æˆ';
                    } else if (signal.status === 'hit_sl') {
                        statusClass = 'text-red-400';
                        statusText = 'SLè§¦å‘';
                    } else if (signal.status === 'active') {
                        statusClass = 'text-yellow-400';
                        statusText = 'è¿›è¡Œä¸­';
                    }
                    
                    let resultClass = 'text-gray-400';
                    let resultText = '-';
                    
                    if (signal.result === 'win') {
                        resultClass = 'text-green-400 font-bold';
                        resultText = `+$${signal.pnl || '0.00'}`;
                    } else if (signal.result === 'loss') {
                        resultClass = 'text-red-400';
                        resultText = `-$${Math.abs(signal.pnl || '0').toFixed(2)}`;
                    }
                    
                    return `
                        <tr class="border-b border-gray-700 hover:bg-gray-700/30 transition-colors">
                            <td class="py-3 px-2">${time}</td>
                            <td class="py-3 px-2">
                                <span class="${actionClass} font-bold">
                                    ${actionIcon} ${signal.action}
                                </span>
                            </td>
                            <td class="py-3 px-2">$${signal.price}</td>
                            <td class="py-3 px-2">
                                <div class="text-green-400 text-sm">TP1: $${signal.tp1}</div>
                                <div class="text-green-300 text-sm">TP2: $${signal.tp2}</div>
                                <div class="text-red-400 text-sm">SL: $${signal.sl}</div>
                            </td>
                            <td class="py-3 px-2">${signal.positionSize} USDT</td>
                            <td class="py-3 px-2">
                                <span class="${statusClass} text-sm">${statusText}</span>
                            </td>
                            <td class="py-3 px-2">
                                <span class="${resultClass} font-semibold">${resultText}</span>
                            </td>
                        </tr>
                    `;
                }).join('');
            }
            
            // æ›´æ–°ç»Ÿè®¡æ•°æ®æ˜¾ç¤º
            updateStatsDisplay() {
                const stats = this.systemState.stats;
                const winRate = stats.totalTrades > 0 ? 
                    ((stats.winningTrades / stats.totalTrades) * 100).toFixed(0) : 0;
                
                const totalTradesElement = document.getElementById('totalTrades');
                const winRateElement = document.getElementById('winRate');
                const totalPnLElement = document.getElementById('totalPnL');
                
                if (totalTradesElement) {
                    totalTradesElement.textContent = stats.totalTrades;
                }
                
                if (winRateElement) {
                    winRateElement.textContent = `${winRate}%`;
                    winRateElement.className = winRate >= 50 ? 
                        'text-xl font-bold text-green-400' : 
                        'text-xl font-bold text-red-400';
                }
                
                if (totalPnLElement) {
                    totalPnLElement.textContent = `$${stats.totalPnL.toFixed(2)}`;
                    totalPnLElement.className = stats.totalPnL >= 0 ? 
                        'text-xl font-bold text-green-400' : 
                        'text-xl font-bold text-red-400';
                }
            }
            
            // æ›´æ–°APIè°ƒç”¨æ¬¡æ•°æ˜¾ç¤º
            updateAPICallsDisplay() {
                const apiCallsElement = document.getElementById('apiCalls');
                if (apiCallsElement) {
                    apiCallsElement.textContent = this.systemState.apiCallCount;
                }
            }
            
            // æ›´æ–°æ‰€æœ‰æ˜¾ç¤º
            updateAllDisplays() {
                this.updatePriceDisplay();
                this.updateIndicatorsDisplay();
                this.updateHistoryTable();
                this.updateStatsDisplay();
                this.updateCooldownDisplay();
                this.updateAPICallsDisplay();
                this.updateLastUpdateTime();
                
                // å¦‚æœæœ‰æ´»è·ƒäº¤æ˜“ï¼Œæ˜¾ç¤ºå®ƒ
                if (this.systemState.activeTrade) {
                    this.displaySignal(this.systemState.activeTrade);
                    this.updateTradeStatus('è¿›è¡Œä¸­', 'äº¤æ˜“æ‰§è¡Œä¸­...');
                } else if (this.systemState.lastSignal) {
                    this.displaySignal(this.systemState.lastSignal);
                }
            }
            
            // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
            updateLastUpdateTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('zh-CN', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                const element = document.getElementById('lastUpdate');
                if (element) {
                    element.textContent = timeString;
                }
            }
            
            // ==================== å›¾è¡¨ç›¸å…³æ–¹æ³• ====================
            
            // åˆå§‹åŒ–å›¾è¡¨
            initChart() {
                const ctx = document.getElementById('priceChart');
                if (!ctx) return;
                
                this.chart = new Chart(ctx.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'BTC/USDT',
                            data: [],
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#d1d5db',
                                    font: {
                                        size: 14
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                ticks: {
                                    color: '#9ca3af',
                                    maxTicksLimit: 8
                                },
                                grid: {
                                    color: '#374151'
                                }
                            },
                            y: {
                                ticks: {
                                    color: '#9ca3af',
                                    callback: function(value) {
                                        return '$' + value.toLocaleString();
                                    }
                                },
                                grid: {
                                    color: '#374151'
                                }
                            }
                        }
                    }
                });
            }
            
            // æ›´æ–°å›¾è¡¨
            updateChart() {
                if (!this.chart || this.chartData.length === 0) return;
                
                this.chart.data.labels = this.chartData.map(item => item.time);
                this.chart.data.datasets[0].data = this.chartData.map(item => item.price);
                this.chart.update();
            }
            
            // ==================== æ§åˆ¶æ–¹æ³• ====================
            
            // å¯åŠ¨è‡ªåŠ¨æ¨¡å¼
            startAutoMode() {
                if (this.isRunning) return;
                
                this.isRunning = true;
                console.log('ğŸš€ å¯åŠ¨å…¨è‡ªåŠ¨æ¨¡å¼');
                
                // æ¯10ç§’æ›´æ–°ä»·æ ¼å¹¶æ£€æŸ¥äº¤æ˜“
                this.intervals.priceUpdate = setInterval(async () => {
                    try {
                        const price = await this.getCurrentPrice();
                        if (price) {
                            this.checkTradeConditions();
                        }
                    } catch (error) {
                        console.error('ä»·æ ¼æ›´æ–°å¤±è´¥:', error);
                    }
                }, 10000);
                
                // æ¯30ç§’æ£€æŸ¥æ˜¯å¦ç”Ÿæˆæ–°ä¿¡å·
                this.intervals.signalCheck = setInterval(() => {
                    this.generateSignal();
                }, 30000);
                
                // æ¯60ç§’æ›´æ–°å›¾è¡¨
                this.intervals.chartUpdate = setInterval(async () => {
                    try {
                        const candles = await this.getCandleData('15m', 30);
                        if (candles.length > 0) {
                            this.processCandleData(candles);
                        }
                    } catch (error) {
                        console.error('å›¾è¡¨æ›´æ–°å¤±è´¥:', error);
                    }
                }, 60000);
                
                this.updateTradeStatus('è¿è¡Œä¸­', 'è‡ªåŠ¨æ¨¡å¼å·²å¯åŠ¨');
            }
            
            // åœæ­¢è‡ªåŠ¨æ¨¡å¼
            stopAutoMode() {
                if (!this.isRunning) return;
                
                this.isRunning = false;
                console.log('ğŸ›‘ åœæ­¢è‡ªåŠ¨æ¨¡å¼');
                
                // æ¸…é™¤æ‰€æœ‰å®šæ—¶å™¨
                Object.values(this.intervals).forEach(interval => {
                    if (interval) clearInterval(interval);
                });
                
                this.updateTradeStatus('å·²åœæ­¢', 'è‡ªåŠ¨æ¨¡å¼å·²åœæ­¢');
            }
            
            // å¼€å§‹å†·å´æ—¶é—´
            startCooldownPeriod() {
                this.systemState.cooldownEnd = new Date(Date.now() + this.TRADE_CONFIG.cooldownTime * 1000);
                this.updateCooldownDisplay();
            }
            
            // æ£€æŸ¥æ˜¯å¦åœ¨å†·å´æœŸ
            isInCooldown() {
                if (!this.systemState.cooldownEnd) return false;
                return new Date() < this.systemState.cooldownEnd;
            }
            
            // ==================== æ•°æ®å­˜å‚¨æ–¹æ³• ====================
            
            // åŠ è½½ç³»ç»ŸçŠ¶æ€
            loadSystemState() {
                try {
                    // åŠ è½½ä¿¡å·å†å²
                    const savedSignals = localStorage.getItem(this.STORAGE_KEYS.signals);
                    if (savedSignals) {
                        const parsed = JSON.parse(savedSignals);
                        this.systemState.signalHistory = parsed.slice(0, 20);
                    }
                    
                    // åŠ è½½ç³»ç»ŸçŠ¶æ€
                    const savedState = localStorage.getItem(this.STORAGE_KEYS.state);
                    if (savedState) {
                        const parsed = JSON.parse(savedState);
                        
                        // åˆå¹¶çŠ¶æ€ï¼Œä¿ç•™å¿…è¦çš„é»˜è®¤å€¼
                        this.systemState = {
                            ...this.systemState,
                            ...parsed,
                            stats: {
                                ...this.systemState.stats,
                                ...parsed.stats
                            }
                        };
                        
                        // ç¡®ä¿æ—¶é—´æˆ³æ˜¯Dateå¯¹è±¡
                        if (this.systemState.cooldownEnd) {
                            this.systemState.cooldownEnd = new Date(this.systemState.cooldownEnd);
                        }
                        
                        if (this.systemState.activeTrade && this.systemState.activeTrade.status === 'active') {
                            // ç¡®ä¿æ´»è·ƒäº¤æ˜“çš„æ—¶é—´æˆ³æ­£ç¡®
                            this.systemState.activeTrade.timestamp = new Date(this.systemState.activeTrade.timestamp);
                        }
                    }
                    
                    console.log('ğŸ“Š ç³»ç»ŸçŠ¶æ€åŠ è½½å®Œæˆ:', {
                        historyCount: this.systemState.signalHistory.length,
                        activeTrade: !!this.systemState.activeTrade,
                        stats: this.systemState.stats
                    });
                    
                } catch (error) {
                    console.error('åŠ è½½ç³»ç»ŸçŠ¶æ€å¤±è´¥:', error);
                }
            }
            
            // ä¿å­˜ç³»ç»ŸçŠ¶æ€
            saveSystemState() {
                try {
                    localStorage.setItem(this.STORAGE_KEYS.signals, 
                        JSON.stringify(this.systemState.signalHistory));
                    
                    localStorage.setItem(this.STORAGE_KEYS.state, 
                        JSON.stringify({
                            lastSignal: this.systemState.lastSignal,
                            activeTrade: this.systemState.activeTrade,
                            stats: this.systemState.stats,
                            lastUpdate: new Date().toISOString(),
                            cooldownEnd: this.systemState.cooldownEnd,
                            isInitialized: this.systemState.isInitialized,
                            apiCallCount: this.systemState.apiCallCount
                        }));
                        
                    console.log('ğŸ’¾ ç³»ç»ŸçŠ¶æ€å·²ä¿å­˜');
                    
                } catch (error) {
                    console.error('ä¿å­˜ç³»ç»ŸçŠ¶æ€å¤±è´¥:', error);
                }
            }
            
            // ==================== å…¬å…±æ–¹æ³• ====================
            
            // æ‰‹åŠ¨ç”Ÿæˆä¿¡å·
            manualGenerateSignal() {
                if (confirm('ç¡®å®šè¦æ‰‹åŠ¨ç”Ÿæˆä¿¡å·å—ï¼Ÿè¿™å¯èƒ½ä¼šè·³è¿‡å†·å´æ—¶é—´ã€‚')) {
                    this.systemState.cooldownEnd = null;
                    this.generateSignal();
                }
            }
            
            // æ‰‹åŠ¨æ£€æŸ¥äº¤æ˜“
            manualCheckTrade() {
                if (this.systemState.activeTrade) {
                    this.checkTradeConditions();
                    alert('å·²æ‰‹åŠ¨æ£€æŸ¥äº¤æ˜“çŠ¶æ€ï¼');
                } else {
                    alert('å½“å‰æ²¡æœ‰æ´»è·ƒäº¤æ˜“');
                }
            }
            
            // é‡ç½®ç³»ç»Ÿ
            resetSystem() {
                if (confirm('ç¡®å®šè¦é‡ç½®ç³»ç»Ÿå—ï¼Ÿè¿™å°†æ¸…é™¤æ‰€æœ‰å†å²æ•°æ®ï¼')) {
                    localStorage.removeItem(this.STORAGE_KEYS.signals);
                    localStorage.removeItem(this.STORAGE_KEYS.state);
                    
                    // é‡ç½®çŠ¶æ€
                    this.systemState = {
                        lastSignal: null,
                        activeTrade: null,
                        signalHistory: [],
                        stats: {
                            totalTrades: 0,
                            winningTrades: 0,
                            totalPnL: 0,
                            currentStreak: 0,
                            bestStreak: 0,
                            maxWin: 0,
                            maxLoss: 0,
                            avgWin: 0,
                            avgLoss: 0
                        },
                        indicators: {
                            rsi: 50,
                            trend: 'neutral',
                            volatility: 0,
                            support: 0,
                            resistance: 0,
                            pricePosition: 50
                        },
                        lastUpdate: null,
                        cooldownEnd: null,
                        isInitialized: false,
                        apiCallCount: 0
                    };
                    
                    this.priceData = [];
                    this.chartData = [];
                    this.currentPrice = 0;
                    
                    // åœæ­¢å®šæ—¶å™¨
                    this.stopAutoMode();
                    
                    // æ›´æ–°æ˜¾ç¤º
                    this.updateAllDisplays();
                    
                    // é‡æ–°åˆå§‹åŒ–
                    setTimeout(() => {
                        this.init();
                    }, 1000);
                    
                    this.showSystemStatus('ç³»ç»Ÿå·²é‡ç½®', 'success');
                    console.log('ğŸ”„ ç³»ç»Ÿå·²é‡ç½®');
                }
            }
            
            // å¯¼å‡ºæ•°æ®
            exportData() {
                if (this.systemState.signalHistory.length === 0) {
                    alert('æ²¡æœ‰å¯å¯¼å‡ºçš„æ•°æ®');
                    return;
                }
                
                const data = {
                    signals: this.systemState.signalHistory,
                    stats: this.systemState.stats,
                    config: this.TRADE_CONFIG,
                    exportTime: new Date().toISOString()
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                const fileName = `trading_data_${new Date().toISOString().slice(0, 10)}.json`;
                
                const link = document.createElement('a');
                link.setAttribute('href', dataUri);
                link.setAttribute('download', fileName);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                this.showSystemStatus(`å·²å¯¼å‡º ${this.systemState.signalHistory.length} æ¡è®°å½•`, 'success');
            }
            
            // åˆ·æ–°æ‰€æœ‰æ•°æ®
            async refreshAllData() {
                try {
                    this.showSystemStatus('åˆ·æ–°æ•°æ®ä¸­...', 'loading');
                    await this.loadInitialData();
                    this.showSystemStatus('æ•°æ®åˆ·æ–°å®Œæˆ', 'success');
                } catch (error) {
                    this.showSystemStatus('æ•°æ®åˆ·æ–°å¤±è´¥', 'error');
                }
            }
            
            // åŠ è½½å›¾è¡¨æ•°æ®
            async loadChartData() {
                try {
                    const timeframe = document.getElementById('timeframeSelect').value;
                    const candles = await this.getCandleData(timeframe, 30);
                    if (candles.length > 0) {
                        this.processCandleData(candles);
                        this.showSystemStatus('å›¾è¡¨æ•°æ®æ›´æ–°æˆåŠŸ', 'success');
                    }
                } catch (error) {
                    console.error('åŠ è½½å›¾è¡¨æ•°æ®å¤±è´¥:', error);
                    this.showSystemStatus('å›¾è¡¨æ›´æ–°å¤±è´¥', 'error');
                }
            }
        }

        // ==================== å…¨å±€å‡½æ•° ====================

        // åˆ›å»ºå…¨å±€å®ä¾‹
        let tradingSystem = null;

        // åˆå§‹åŒ–å‡½æ•°
        function initTradingSystem() {
            if (!tradingSystem) {
                tradingSystem = new AutoTradingSystem();
                tradingSystem.init();
            }
            return tradingSystem;
        }

        // å…¬å…±APIå‡½æ•°
        function manualCheckTP_SL() {
            if (tradingSystem && tradingSystem.manualCheckTrade) {
                tradingSystem.manualCheckTrade();
            } else {
                alert('ç³»ç»Ÿæœªåˆå§‹åŒ–');
            }
        }

        function forceNewSignal() {
            if (tradingSystem && tradingSystem.manualGenerateSignal) {
                tradingSystem.manualGenerateSignal();
            } else {
                alert('ç³»ç»Ÿæœªåˆå§‹åŒ–');
            }
        }

        function refreshAllData() {
            if (tradingSystem && tradingSystem.refreshAllData) {
                tradingSystem.refreshAllData();
            } else {
                alert('ç³»ç»Ÿæœªåˆå§‹åŒ–');
            }
        }

        function resetSystem() {
            if (tradingSystem && tradingSystem.resetSystem) {
                tradingSystem.resetSystem();
            } else {
                if (confirm('ç³»ç»Ÿæœªåˆå§‹åŒ–ï¼Œç¡®å®šè¦é‡ç½®å—ï¼Ÿ')) {
                    localStorage.clear();
                    location.reload();
                }
            }
        }

        function exportSignals() {
            if (tradingSystem && tradingSystem.exportData) {
                tradingSystem.exportData();
            } else {
                alert('ç³»ç»Ÿæœªåˆå§‹åŒ–');
            }
        }

        function testAPIConnection() {
            if (tradingSystem && tradingSystem.testAPIConnection) {
                tradingSystem.testAPIConnection()
                    .then(() => alert('âœ… APIè¿æ¥æ­£å¸¸'))
                    .catch(() => alert('âŒ APIè¿æ¥å¤±è´¥'));
            } else {
                alert('ç³»ç»Ÿæœªåˆå§‹åŒ–');
            }
        }

        function startAutoMode() {
            if (tradingSystem && tradingSystem.startAutoMode) {
                tradingSystem.startAutoMode();
                alert('è‡ªåŠ¨æ¨¡å¼å·²å¯åŠ¨');
            } else {
                alert('ç³»ç»Ÿæœªåˆå§‹åŒ–');
            }
        }

        function stopAutoMode() {
            if (tradingSystem && tradingSystem.stopAutoMode) {
                tradingSystem.stopAutoMode();
                alert('è‡ªåŠ¨æ¨¡å¼å·²åœæ­¢');
            } else {
                alert('ç³»ç»Ÿæœªåˆå§‹åŒ–');
            }
        }

        function loadChartData() {
            if (tradingSystem && tradingSystem.loadChartData) {
                tradingSystem.loadChartData();
            } else {
                alert('ç³»ç»Ÿæœªåˆå§‹åŒ–');
            }
        }

        function showAllSignals() {
            if (tradingSystem) {
                tradingSystem.updateHistoryTable();
                alert('æ˜¾ç¤ºæ‰€æœ‰ä¿¡å·è®°å½•');
            }
        }

        function showOnlyProfitable() {
            if (tradingSystem && tradingSystem.systemState.signalHistory) {
                const profitable = tradingSystem.systemState.signalHistory.filter(s => s.result === 'win');
                alert(`æ˜¾ç¤º ${profitable.length} ä¸ªç›ˆåˆ©ä¿¡å·`);
            }
        }

        function clearHistory() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
                localStorage.removeItem('auto_trading_signals_v2');
                if (tradingSystem) {
                    tradingSystem.systemState.signalHistory = [];
                    tradingSystem.updateHistoryTable();
                    tradingSystem.updateStatsDisplay();
                }
                alert('å†å²è®°å½•å·²æ¸…ç©º');
            }
        }

        function showSettings() {
            const settings = `
å½“å‰è®¾ç½®:
â€¢ äº¤æ˜“å¯¹: BTC-USDT
â€¢ è´¦æˆ·æœ¬é‡‘: 100 USDT
â€¢ å•ç¬”é£é™©: 2%
â€¢ TP1: +1.5% (å¾®åˆ©)
â€¢ TP2: +3% (ä¸­åˆ©)
â€¢ SL: -1.2% (å°æŸ)
â€¢ å†·å´æ—¶é—´: 3åˆ†é’Ÿ
â€¢ RSIè¶…å–: <28
â€¢ RSIè¶…ä¹°: >72
â€¢ æ•°æ®æº: OKXäº¤æ˜“æ‰€
â€¢ ç‰ˆæœ¬: v2.1
            `;
            alert(settings);
        }

        // ==================== é¡µé¢åŠ è½½åˆå§‹åŒ– ====================

        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“ˆ BTC/USDT è‡ªåŠ¨äº¤æ˜“ç³»ç»ŸåŠ è½½ä¸­...');
            console.log('ğŸ•’ å¯åŠ¨æ—¶é—´:', new Date().toLocaleString('zh-CN'));
            
            // æ˜¾ç¤ºå¯åŠ¨ä¿¡æ¯
            const welcomeMsg = `
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   ğŸš€ BTC/USDT è‡ªåŠ¨äº¤æ˜“ç³»ç»Ÿ v2.1           â•‘
â•‘                                            â•‘
â•‘   ç³»ç»Ÿç‰¹æ€§:                               â•‘
â•‘   â€¢ å…¨è‡ªåŠ¨è¿è¡Œï¼Œæ— éœ€äººå·¥å¹²é¢„              â•‘
â•‘   â€¢ æ‰€æœ‰è®¿é—®è€…ä¿¡å·ä¸€è‡´                    â•‘
â•‘   â€¢ æ™ºèƒ½åˆ†æï¼Œè¯¦ç»†ä¿¡å·åŸå›                 â•‘
â•‘   â€¢ ä¼˜åŒ–é£é™©æ§åˆ¶ (SL:1.2%, TP:1.5%/3%)   â•‘
â•‘   â€¢ è‡ªåŠ¨æ£€æµ‹TP/SLï¼Œå®Œæˆæ‰ç»™æ–°ä¿¡å·         â•‘
â•‘                                            â•‘
â•‘   æ•°æ®æº: OKXäº¤æ˜“æ‰€ API                   â•‘
â•‘   æ—¶é—´æ¡†æ¶: 15åˆ†é’Ÿ                         â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            `;
            console.log(welcomeMsg);
            
            // åˆå§‹åŒ–ç³»ç»Ÿ
            tradingSystem = initTradingSystem();
            
            // æš´éœ²åˆ°å…¨å±€
            window.tradingSystem = tradingSystem;
            
            // æ·»åŠ é”™è¯¯å¤„ç†
            window.addEventListener('error', function(event) {
                console.error('å…¨å±€é”™è¯¯:', event.error);
                const statusElement = document.getElementById('systemStatus');
                if (statusElement) {
                    statusElement.textContent = 'âŒ ç³»ç»Ÿé”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢';
                    statusElement.className = 'text-red-400';
                }
            });
            
            // é¡µé¢å¯è§æ€§å˜åŒ–å¤„ç†
            document.addEventListener('visibilitychange', function() {
                if (tradingSystem && tradingSystem.isRunning) {
                    if (document.hidden) {
                        console.log('é¡µé¢éšè—ï¼Œæš‚åœéƒ¨åˆ†æ›´æ–°');
                    } else {
                        console.log('é¡µé¢æ˜¾ç¤ºï¼Œæ¢å¤æ­£å¸¸æ›´æ–°');
                        tradingSystem.loadInitialData().catch(console.error);
                    }
                }
            });
            
            // åˆå§‹åŒ–æœ€åæ›´æ–°æ—¶é—´æ˜¾ç¤º
            function updateLastUpdateTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('zh-CN', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
                const element = document.getElementById('lastUpdate');
                if (element) {
                    element.textContent = timeString;
                }
            }
            
            // æ¯10ç§’æ›´æ–°æ—¶é—´
            setInterval(updateLastUpdateTime, 10000);
            updateLastUpdateTime();
        });

        console.log('âœ… JavaScriptä»£ç åŠ è½½å®Œæˆ');
    </script>
</body>
</html>